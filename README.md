# アリ類群集・植生データ管理システム v1.0 🎊完成🎊

研究によって得られた「同所的アリ類群集」および「立地環境（植生）」の調査データを効率的に管理・解析するためのデスクトップアプリケーションです。

**全ての開発フェーズ（Phase 1-5）が完了しました！**

## 📋 実装済み機能（全て完成✨）
**Phase 1: 基盤構築**
- ✓ データベース構築（SQLite3）
- ✓ 親調査地の登録・編集・閲覧
- ✓ 調査地の登録・編集・閲覧
- ✓ 検索機能（キーワード検索、親調査地フィルタ）
- ✓ サンプルデータ自動生成
- ✓ 自動バックアップ機能
- ✓ GUIベースの直感的な操作

**Phase 2: データ入力機能拡充**
- ✓ 調査イベント管理（日時、天候、調査者記録）
- ✓ 植生データ入力（優占種、被度、段階評価など全16項目）
- ✓ アリ類データ入力・種名マスタ管理
- ✓ データバリデーション機能
- ✓ 調査イベントごとの出現記録管理
- ✓ 種別出現統計の表示
- ✓ サンプルデータ拡充（イベント20件、種30種、記録多数）

**Phase 3: 解析・出力機能**
- ✓ CSV/Excel出力機能
  - アリ類群集行列（在不在/個体数）
  - 植生データ行列
  - 統合データ（植生+多様度）
  - 全データExcel出力（複数シート）
- ✓ 統計解析機能
  - 種多様度指数（Shannon, Simpson, Pielou, Berger-Parker）
  - 種数累積曲線
  - 植生データ基本統計量
- ✓ 可視化機能
  - 散布図作成（任意の2変数）
  - 回帰直線表示
  - 相関分析（Pearson/Spearman）
  - 多様度比較グラフ

**Phase 4: 地図・可視化**
- ✓ インタラクティブ地図表示
  - 親調査地・調査地のプロット
  - 種多様度による色分け
  - ポップアップで詳細情報表示
- ✓ ヒートマップ
  - 種多様度の空間分布を可視化
- ✓ クラスタ解析
  - K-Means法による地点分類
  - 階層的クラスタリング（樹形図）
  - クラスタ地図の生成
- ✓ 距離行列計算
  - Haversine公式による地点間距離
  - CSV出力機能

**Phase 5: 管理・完成（✨NEW）**
- ✓ データ整合性チェック
  - 孤立レコードの検出
  - 重複データの検出
  - 不正な値の検出
  - 必須データの欠落チェック
  - 座標の妥当性チェック
- ✓ バックアップ管理
  - 手動バックアップ作成
  - 自動バックアップ設定
  - バックアップ履歴表示
- ✓ アプリケーション設定
  - UI設定（フォントサイズ、ウィンドウサイズ）
  - エクスポート設定（文字コード、日付形式）
  - 設定の保存・読み込み
- ✓ データベース統計表示
- ✓ アプリケーション情報

## 🚀 セットアップ手順

### 1. 前提条件
- Python 3.9 以上
- pip（Pythonパッケージ管理ツール）
- tkinter（Python標準ライブラリ、通常は自動インストール）

### 2. プロジェクトのダウンロード
```bash
# プロジェクトをクローンまたはダウンロード
cd ant_research_system
```

### 3. 仮想環境の作成（推奨）
```bash
# Windowsの場合
python -m venv venv
venv\Scripts\activate

# macOS/Linuxの場合
python3 -m venv venv
source venv/bin/activate
```

### 4. 依存パッケージのインストール
```bash
pip install -r requirements.txt
```

### 5. アプリケーションの起動
```bash
python main.py
```

初回起動時には：
- データベースが自動作成されます
- サンプルデータ（親調査地10件、調査地50件）が生成されます
- 自動的にGUIウィンドウが開きます

## 📂 プロジェクト構造

```
ant_research_system/
├── main.py                 # アプリケーション起動ファイル
├── config.ini              # 設定ファイル
├── requirements.txt        # 依存パッケージ
├── README.md              # このファイル
│
├── models/                 # データモデル
│   ├── database.py        # DB接続・初期化
│   ├── parent_site.py     # 親調査地モデル
│   └── survey_site.py     # 調査地モデル
│
├── views/                  # GUIビュー
│   ├── main_window.py     # メインウィンドウ
│   ├── input_tab.py       # 入力タブ
│   └── view_tab.py        # 閲覧タブ
│
├── utils/                  # ユーティリティ
│   └── sample_data.py     # サンプルデータ生成
│
├── data/                   # データベースファイル保存先
├── backups/               # バックアップ保存先
├── logs/                  # ログファイル保存先
└── exports/               # エクスポートファイル保存先
```

## 💡 使い方

### 親調査地の登録
1. 「📝 データ入力」タブを開く
2. 「親調査地」サブタブを選択
3. 必須項目（名称、緯度、経度）を入力
4. 「登録」ボタンをクリック

### 調査地の登録
1. 「📝 データ入力」タブを開く
2. 「調査地」サブタブを選択
3. 親調査地をプルダウンから選択
4. 必須項目（名称、緯度、経度）を入力
5. 「登録」ボタンをクリック

### データの閲覧・検索
1. 「📋 データ閲覧」タブを開く
2. 親調査地または調査地のサブタブを選択
3. 検索ボックスにキーワードを入力して検索
4. 一覧から目的のデータを確認

### 調査イベントの登録 ✨NEW
1. 「📝 データ入力」タブ → 「調査イベント」を開く
2. 調査地を選択
3. 調査日時、天候、気温などを入力
4. 「登録」ボタンをクリック

### 植生データの入力 ✨NEW
1. 「📝 データ入力」タブ → 「植生データ」を開く
2. 調査イベントを選択
3. 優占種、被度、段階評価などを入力
4. 「登録」ボタンをクリック

### アリ類データの入力 ✨NEW
1. 「📝 データ入力」タブ → 「アリ類データ」を開く
2. 調査イベントを選択
3. 種を選択（または新規登録）
4. 個体数を入力
5. 「記録を追加」ボタンをクリック
6. 同じイベントで複数種を連続入力可能

### 種別統計の確認
1. 「📋 データ閲覧」タブ → 「アリ類出現記録」を開く
2. 「📊 種別統計」ボタンをクリック
3. 各種の出現頻度、総個体数、平均個体数を確認

### データのエクスポート ✨NEW
1. 「📊 解析・出力」タブ → 「データ出力」を開く
2. 出力したいデータ形式を選択
   - アリ類群集行列（在不在 or 個体数）
   - 植生データ行列
   - 統合データ（植生+多様度）
   - 全データExcel出力
3. ボタンをクリックして出力
4. 「出力先フォルダを開く」で確認

### 多様度分析 ✨NEW
1. 「📊 解析・出力」タブ → 「多様度分析」を開く
2. 「多様度指数を計算」をクリック
3. 各調査地のShannon指数、Simpson指数等を確認
4. 「比較グラフを表示」で視覚的に比較
5. 「種数累積曲線を表示」で調査の充足度を確認

### 散布図・相関分析 ✨NEW
1. 「📊 解析・出力」タブ → 「散布図・相関分析」を開く
2. X軸とY軸の変数を選択（例：樹冠被度 vs 光条件）
3. 「散布図を作成」をクリック
4. 相関係数とp値を確認
5. 回帰直線で傾向を把握

### 基本統計量の確認
1. 「📊 解析・出力」タブ → 「基本統計量」を開く
2. 「統計量を計算」をクリック
3. 各植生変数の平均、標準偏差、最小値、最大値等を確認

### 地図の表示 ✨NEW
1. 「🗺️ 地図」タブ → 「地図表示」を開く
2. 表示オプションをチェック
   - 親調査地を表示
   - 調査地を表示
   - 種多様度で色分け
3. 「地図を生成」をクリック
4. ブラウザで地図が自動的に開く
5. マーカーをクリックして詳細情報を確認

### ヒートマップの作成 ✨NEW
1. 「🗺️ 地図」タブ → 「地図表示」を開く
2. 「ヒートマップを生成」をクリック
3. 種多様度の高い地域が赤く表示される
4. ズームして詳細を確認

### クラスタ解析の実行 ✨NEW
1. 「🗺️ 地図」タブ → 「クラスタ解析」を開く
2. 対象（調査地 or 親調査地）を選択
3. クラスタ数を設定（2-10）
4. 「クラスタリング実行」をクリック
5. 結果を一覧で確認
6. 「クラスタ地図を生成」で視覚化
7. 「樹形図を表示」で階層構造を確認

### 距離行列の計算
1. 「🗺️ 地図」タブ → 「距離行列」を開く
2. 対象を選択
3. 「距離を計算」をクリック
4. 地点間の距離（km）を確認
5. 「CSVに出力」で保存

### データ整合性チェック ✨NEW
1. 「⚙️ 設定」タブ → 「データ整合性チェック」を開く
2. 「チェック実行」をクリック
3. 検出された問題を確認
   - 🔴 高: 緊急対応が必要
   - 🟡 中: 注意が必要
   - 🟢 低: 確認推奨
4. データベース統計で全体の状況を把握

### バックアップの作成 ✨NEW
1. 「⚙️ 設定」タブ → 「バックアップ」を開く
2. 「今すぐバックアップを作成」をクリック
3. バックアップ履歴で過去のバックアップを確認
4. 自動バックアップ設定を調整

### アプリケーション設定 ✨NEW
1. 「⚙️ 設定」タブ → 「アプリケーション設定」を開く
2. UI設定を調整
   - フォントサイズ（8-14）
   - ウィンドウサイズ
3. エクスポート設定を調整
   - CSV文字コード
   - 日付形式
4. 「設定を保存」をクリック
5. アプリケーション再起動で反映

## ⚙️ 設定のカスタマイズ

`config.ini` を編集することで、以下の設定を変更できます：

```ini
[Database]
path = data/ant_database.db      # データベースファイルのパス
backup_dir = backups              # バックアップ保存先
auto_backup = True                # 自動バックアップの有効/無効

[UI]
window_width = 1400               # ウィンドウ幅
window_height = 900               # ウィンドウ高さ
font_size = 10                    # フォントサイズ

[SampleData]
generate_on_first_run = True      # 初回起動時のサンプルデータ生成
```

## 🔧 トラブルシューティング

### tkinterが見つからないエラー
Pythonインストール時に「tcl/tk and IDLE」がインストールされていることを確認してください。

### データベースがロックされる
アプリケーションを二重起動していないか確認してください。

### バックアップファイルを復元したい
1. アプリケーションを終了
2. `data/ant_database.db` を削除
3. `backups/` 内の目的のバックアップファイルを `data/ant_database.db` にリネーム
4. アプリケーションを再起動

## 📊 データベース情報

### テーブル構成
- `parent_sites` - 親調査地
- `survey_sites` - 調査地
- `survey_events` - 調査イベント ✨
- `vegetation_data` - 植生データ ✨
- `species_master` - 種名マスタ ✨
- `ant_records` - アリ類出現記録 ✨
- `environment_tags` - 環境タグマスタ

### バックアップについて
- 起動時に自動的に前回のデータベースをバックアップ
- バックアップは `backups/` ディレクトリに日時付きで保存
- 最大10世代まで保持（古いものから自動削除）

## 📝 開発完了！

### Phase 1（✅ 完了）- 基盤構築
- データベース設計・実装
- 親調査地・調査地の入力・閲覧機能
- 基本的なGUI

### Phase 2（✅ 完了）- データ入力機能拡充
- 調査イベント管理
- 植生データ入力
- アリ類データ入力
- バリデーション強化
- 種別統計表示

### Phase 3（✅ 完了）- 解析・出力機能
- CSV/Excel出力（行列変換）
- 多様度指数計算
- 散布図作成
- 相関分析
- 基本統計量

### Phase 4（✅ 完了）- 地図・可視化
- インタラクティブ地図表示
- ヒートマップ
- K-Meansクラスタ解析
- 階層的クラスタリング
- 距離行列計算

### Phase 5（✅ 完了）- 管理・完成
- データ整合性チェック
- バックアップ管理
- アプリケーション設定
- 統計情報表示
- 完成🎉

## 🐛 バグ報告・機能要望

問題が発生した場合や新機能の要望がある場合は、以下の情報を含めて報告してください：
- OSとバージョン
- Pythonバージョン
- エラーメッセージ（ある場合）
- 再現手順

## 📄 ライセンス

研究用途での使用を想定しています。

## 👤 開発者

研究者本人

---

**バージョン:** 1.0.0（完成版🎊）  
**最終更新:** 2025年12月11日  
**開発状況:** 全フェーズ完了！  
**総開発期間:** Phase 1-5  
**総機能数:** 50以上の機能を実装

## 🎉 おめでとうございます！

アリ類群集・植生データ管理システムが完成しました！

このシステムは、データ入力から解析、可視化、管理まで、
研究活動に必要な全ての機能を備えた完全なソリューションです。

研究の成功をお祈りしています！🐜✨