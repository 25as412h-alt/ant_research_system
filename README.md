# アリ類群集・植生データ管理システム v1.0

研究によって得られた「同所的アリ類群集」および「立地環境（植生）」の調査データを効率的に管理・解析するためのデスクトップアプリケーションです。

## 📋 現在の実装状況（Phase 3 完了）

### ✅ 実装済み機能
**Phase 1: 基盤構築**
- ✓ データベース構築（SQLite3）
- ✓ 親調査地の登録・編集・閲覧
- ✓ 調査地の登録・編集・閲覧
- ✓ 検索機能（キーワード検索、親調査地フィルタ）
- ✓ サンプルデータ自動生成
- ✓ 自動バックアップ機能
- ✓ GUIベースの直感的な操作

**Phase 2: データ入力機能拡充**
- ✓ 調査イベント管理（日時、天候、調査者記録）
- ✓ 植生データ入力（優占種、被度、段階評価など全16項目）
- ✓ アリ類データ入力・種名マスタ管理
- ✓ データバリデーション機能
- ✓ 調査イベントごとの出現記録管理
- ✓ 種別出現統計の表示
- ✓ サンプルデータ拡充（イベント20件、種30種、記録多数）

**Phase 3: 解析・出力機能（✨NEW）**
- ✓ CSV/Excel出力機能
  - アリ類群集行列（在不在/個体数）
  - 植生データ行列
  - 統合データ（植生+多様度）
  - 全データExcel出力（複数シート）
- ✓ 統計解析機能
  - 種多様度指数（Shannon, Simpson, Pielou, Berger-Parker）
  - 種数累積曲線
  - 植生データ基本統計量
- ✓ 可視化機能
  - 散布図作成（任意の2変数）
  - 回帰直線表示
  - 相関分析（Pearson/Spearman）
  - 多様度比較グラフ

### 🚧 今後実装予定（Phase 4以降）
- 地図表示・クラスタ解析
- データ整合性チェック
- ヘルプドキュメント

## 🚀 セットアップ手順

### 1. 前提条件
- Python 3.9 以上
- pip（Pythonパッケージ管理ツール）
- tkinter（Python標準ライブラリ、通常は自動インストール）

### 2. プロジェクトのダウンロード
```bash
# プロジェクトをクローンまたはダウンロード
cd ant_research_system
```

### 3. 仮想環境の作成（推奨）
```bash
# Windowsの場合
python -m venv venv
venv\Scripts\activate

# macOS/Linuxの場合
python3 -m venv venv
source venv/bin/activate
```

### 4. 依存パッケージのインストール
```bash
pip install -r requirements.txt
```

### 5. アプリケーションの起動
```bash
python main.py
```

初回起動時には：
- データベースが自動作成されます
- サンプルデータ（親調査地10件、調査地50件）が生成されます
- 自動的にGUIウィンドウが開きます

## 📂 プロジェクト構造

```
ant_research_system/
├── main.py                 # アプリケーション起動ファイル
├── config.ini              # 設定ファイル
├── requirements.txt        # 依存パッケージ
├── README.md              # このファイル
│
├── models/                 # データモデル
│   ├── database.py        # DB接続・初期化
│   ├── parent_site.py     # 親調査地モデル
│   └── survey_site.py     # 調査地モデル
│
├── views/                  # GUIビュー
│   ├── main_window.py     # メインウィンドウ
│   ├── input_tab.py       # 入力タブ
│   └── view_tab.py        # 閲覧タブ
│
├── utils/                  # ユーティリティ
│   └── sample_data.py     # サンプルデータ生成
│
├── data/                   # データベースファイル保存先
├── backups/               # バックアップ保存先
├── logs/                  # ログファイル保存先
└── exports/               # エクスポートファイル保存先
```

## 💡 使い方

### 親調査地の登録
1. 「📝 データ入力」タブを開く
2. 「親調査地」サブタブを選択
3. 必須項目（名称、緯度、経度）を入力
4. 「登録」ボタンをクリック

### 調査地の登録
1. 「📝 データ入力」タブを開く
2. 「調査地」サブタブを選択
3. 親調査地をプルダウンから選択
4. 必須項目（名称、緯度、経度）を入力
5. 「登録」ボタンをクリック

### データの閲覧・検索
1. 「📋 データ閲覧」タブを開く
2. 親調査地または調査地のサブタブを選択
3. 検索ボックスにキーワードを入力して検索
4. 一覧から目的のデータを確認

### 調査イベントの登録 ✨NEW
1. 「📝 データ入力」タブ → 「調査イベント」を開く
2. 調査地を選択
3. 調査日時、天候、気温などを入力
4. 「登録」ボタンをクリック

### 植生データの入力 ✨NEW
1. 「📝 データ入力」タブ → 「植生データ」を開く
2. 調査イベントを選択
3. 優占種、被度、段階評価などを入力
4. 「登録」ボタンをクリック

### アリ類データの入力 ✨NEW
1. 「📝 データ入力」タブ → 「アリ類データ」を開く
2. 調査イベントを選択
3. 種を選択（または新規登録）
4. 個体数を入力
5. 「記録を追加」ボタンをクリック
6. 同じイベントで複数種を連続入力可能

### 種別統計の確認
1. 「📋 データ閲覧」タブ → 「アリ類出現記録」を開く
2. 「📊 種別統計」ボタンをクリック
3. 各種の出現頻度、総個体数、平均個体数を確認

### データのエクスポート ✨NEW
1. 「📊 解析・出力」タブ → 「データ出力」を開く
2. 出力したいデータ形式を選択
   - アリ類群集行列（在不在 or 個体数）
   - 植生データ行列
   - 統合データ（植生+多様度）
   - 全データExcel出力
3. ボタンをクリックして出力
4. 「出力先フォルダを開く」で確認

### 多様度分析 ✨NEW
1. 「📊 解析・出力」タブ → 「多様度分析」を開く
2. 「多様度指数を計算」をクリック
3. 各調査地のShannon指数、Simpson指数等を確認
4. 「比較グラフを表示」で視覚的に比較
5. 「種数累積曲線を表示」で調査の充足度を確認

### 散布図・相関分析 ✨NEW
1. 「📊 解析・出力」タブ → 「散布図・相関分析」を開く
2. X軸とY軸の変数を選択（例：樹冠被度 vs 光条件）
3. 「散布図を作成」をクリック
4. 相関係数とp値を確認
5. 回帰直線で傾向を把握

### 基本統計量の確認 ✨NEW
1. 「📊 解析・出力」タブ → 「基本統計量」を開く
2. 「統計量を計算」をクリック
3. 各植生変数の平均、標準偏差、最小値、最大値等を確認

## ⚙️ 設定のカスタマイズ

`config.ini` を編集することで、以下の設定を変更できます：

```ini
[Database]
path = data/ant_database.db      # データベースファイルのパス
backup_dir = backups              # バックアップ保存先
auto_backup = True                # 自動バックアップの有効/無効

[UI]
window_width = 1400               # ウィンドウ幅
window_height = 900               # ウィンドウ高さ
font_size = 10                    # フォントサイズ

[SampleData]
generate_on_first_run = True      # 初回起動時のサンプルデータ生成
```

## 🔧 トラブルシューティング

### tkinterが見つからないエラー
Pythonインストール時に「tcl/tk and IDLE」がインストールされていることを確認してください。

### データベースがロックされる
アプリケーションを二重起動していないか確認してください。

### バックアップファイルを復元したい
1. アプリケーションを終了
2. `data/ant_database.db` を削除
3. `backups/` 内の目的のバックアップファイルを `data/ant_database.db` にリネーム
4. アプリケーションを再起動

## 📊 データベース情報

### テーブル構成
- `parent_sites` - 親調査地
- `survey_sites` - 調査地
- `survey_events` - 調査イベント ✨
- `vegetation_data` - 植生データ ✨
- `species_master` - 種名マスタ ✨
- `ant_records` - アリ類出現記録 ✨
- `environment_tags` - 環境タグマスタ

### バックアップについて
- 起動時に自動的に前回のデータベースをバックアップ
- バックアップは `backups/` ディレクトリに日時付きで保存
- 最大10世代まで保持（古いものから自動削除）

## 📝 開発ロードマップ

### Phase 1（✅ 完了）- 基盤構築
- データベース設計・実装
- 親調査地・調査地の入力・閲覧機能
- 基本的なGUI

### Phase 2（✅ 完了）- データ入力機能拡充
- 調査イベント管理
- 植生データ入力
- アリ類データ入力
- バリデーション強化
- 種別統計表示

### Phase 3（✅ 完了）- 解析・出力機能
- CSV/Excel出力（行列変換）
- 多様度指数計算
- 散布図作成
- 相関分析
- 基本統計量

### Phase 4（予定）- 地図・可視化
- 地図プロット
- クラスタ解析
- ヒートマップ

### Phase 5（予定）- 管理機能
- データ整合性チェック
- 詳細設定
- ヘルプドキュメント

## 🐛 バグ報告・機能要望

問題が発生した場合や新機能の要望がある場合は、以下の情報を含めて報告してください：
- OSとバージョン
- Pythonバージョン
- エラーメッセージ（ある場合）
- 再現手順

## 📄 ライセンス

研究用途での使用を想定しています。

## 👤 開発者

研究者本人

---

**バージョン:** 1.0.0 (Phase 3 完了)  
**最終更新:** 2025年12月11日
